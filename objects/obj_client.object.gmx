<!--This Document is generated by GameMaker, if you edit it by hand then you do so at your own risk!-->
<object>
  <spriteName>&lt;undefined&gt;</spriteName>
  <solid>0</solid>
  <visible>-1</visible>
  <depth>-1</depth>
  <persistent>0</persistent>
  <parentName>&lt;undefined&gt;</parentName>
  <maskName>&lt;undefined&gt;</maskName>
  <events>
    <event eventtype="0" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>/// Initialise the client
if (instance_number(obj_server) &gt; 0) { instance_destroy(); exit;  }
clientx = 64;   // player start X and Y
clienty = 192;
oxygen = 200;
max_oxygen = 200;
PlayerName=global.ServerName;   // get the name that was selected (it's a server OR player name)

// Create a buffer for the network messages
buff = buffer_create(512, buffer_grow, 1);
// Create a TCP/IP socket
client = network_create_socket(global.ServerType);
// remember this socket ID so the server can ignore it (if we have a local server)
global.client = client;
// We're playing!!
global.NetworkState = NETWORK_PLAY;

// Create a list to hold ALL sprites sent from the server
allsprites = ds_list_create();
sprites = 0;

// Connect to our server
var err = network_connect(client, global.connectip, 6510);
if( err!=0 ){
    // if we can't connect, show and error and restart... could be more graceful :)
    show_message("Error - can not connect to server!!");
    game_restart();
}

// Client has connected to the server, so send our "player name"
alarm[0]=120;
instance_create(0,0, obj_coop_oxygen_bar);
</string>
          </argument>
        </arguments>
      </action>
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///Create object maps
player_map = ds_map_create();
explode_map = ds_map_create();
star_sparkle_map = ds_map_create();
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="2" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>SendKeepAlive();
alarm[0]=120;
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="3" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///Send joystick positions
if (instance_number(obj_controller) &gt; 0) {
  SendTouch(obj_controller);
}
</string>
          </argument>
        </arguments>
      </action>
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///Set view to follow camera
if (instance_number(obj_camera) &lt;= 0) {
  with(instance_create(x,y, obj_camera)) {
    follow = obj_client;
  }
  view_object[0] = obj_camera;
}
</string>
          </argument>
        </arguments>
      </action>
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>/// Create and alter any objects as required
var index = 0;
for(i=0;i&lt;sprites;i++){
    var iid, obj, xx,yy,sp, spindex, col, angle, alpha, xsc, ysc, hp, max_hp,
        spwidth, spheight, face_dir, state;
    iid = ds_list_find_value(allsprites,index++);
    obj = ds_list_find_value(allsprites,index++);
    xx = ds_list_find_value(allsprites,index++);
    yy = ds_list_find_value(allsprites,index++);
    sp = ds_list_find_value(allsprites,index++);
    spindex = ds_list_find_value(allsprites,index++);
    col = ds_list_find_value(allsprites,index++);
    angle = ds_list_find_value(allsprites,index++);
    alpha = ds_list_find_value(allsprites,index++);
    xsc = ds_list_find_value(allsprites,index++);
    ysc = ds_list_find_value(allsprites,index++);
    hp = ds_list_find_value(allsprites,index++);
    max_hp = ds_list_find_value(allsprites,index++);
    spwidth = ds_list_find_value(allsprites,index++);
    spheight = ds_list_find_value(allsprites,index++);
    face_dir = ds_list_find_value(allsprites,index++);
    state = ds_list_find_value(allsprites,index++);
    
    if (sp == spr_ship_edit) {
      if (is_undefined(ds_map_find_value(player_map, iid))) {
        player_map[? iid] = instance_create(xx, yy, obj_draw_tail);
      }
      with (player_map[? iid]) {
        tail_x = xx; tail_y = yy;
      }
    }
    
    if (obj == obj_explode64 || obj == obj_explode || obj == obj_explode_256 ||
          obj == obj_explode_256) {
      if (is_undefined(ds_map_find_value(explode_map, iid))) {
        explode_map[? iid] = instance_create(xx, yy, obj);
      }  
    }
    
    if (obj == obj_star_sparkle) {
      if (is_undefined(ds_map_find_value(star_sparkle_map, iid))) {
        star_sparkle_map[? iid] = instance_create(xx, yy, obj_star_sparkle);
      }  
    }
    
}

</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="7" enumb="68">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>/// Networking code
var eventid = ds_map_find_value(async_load, "id");

// Our socket?
if( client == eventid )
{
    switch(global.NetworkState)
    {
        case NETWORK_PLAY :
        {
            // Read all data....
            var buff = ds_map_find_value(async_load, "buffer");
            // Get number of sprites sent
            sprites = buffer_read(buff, buffer_u32 ); 
            
            // Read out OUR location (allow scrolling maps)
            clientx = buffer_read(buff,buffer_s16);     //x
            clienty = buffer_read(buff,buffer_s16);     //y
            
            oxygen = buffer_read(buff,buffer_s16);     //oxygen
            max_oxygen = buffer_read(buff,buffer_s16);     //max_oxygen
            
            score = buffer_read(buff,buffer_s16); //score
        
            // Now clear the render list, and start filling it up with NEW data!
            ds_list_clear(allsprites);
            for(var i=0;i&lt;sprites;i++){
                ds_list_add(allsprites, buffer_read(buff,buffer_s16) );     //id
                ds_list_add(allsprites, buffer_read(buff,buffer_s16) );     //object_index
                ds_list_add(allsprites, buffer_read(buff,buffer_s16) );     //x
                ds_list_add(allsprites, buffer_read(buff,buffer_s16) );     //y
                ds_list_add(allsprites, buffer_read(buff,buffer_s16) );     //sprite_index
                ds_list_add(allsprites, buffer_read(buff,buffer_s16) );     //image_index
                ds_list_add(allsprites, buffer_read(buff,buffer_s16) );     //image_blend
                ds_list_add(allsprites, buffer_read(buff,buffer_s16) );     //image_angle
                ds_list_add(allsprites, buffer_read(buff,buffer_s16) );     //image_alpha
                ds_list_add(allsprites, buffer_read(buff,buffer_s16) );     //image_xscale
                ds_list_add(allsprites, buffer_read(buff,buffer_s16) );     //image_yscale
                ds_list_add(allsprites, buffer_read(buff,buffer_u16) );     //hp
                ds_list_add(allsprites, buffer_read(buff,buffer_u16) );     //max_hp
                ds_list_add(allsprites, buffer_read(buff,buffer_s16) );     //sprite_width
                ds_list_add(allsprites, buffer_read(buff,buffer_s16) );     //sprite_height
                ds_list_add(allsprites, buffer_read(buff,buffer_s16) );     //face_dir
                ds_list_add(allsprites, buffer_read(buff,buffer_s16) );     //state
            }  
        }    
    }
}



</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="8" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>/// Draw all sprites in level

// set the X and Y of the client so the room "follows" our player
x = clientx;
y = clienty;

// Now loop through all active sprites and draw them
var index = 0;
for(i=0;i&lt;sprites;i++){
    var iid, obj, xx,yy,sp, spindex, col, angle, alpha, xsc, ysc, hp, max_hp, spwidth, spheight,
        face_dir, state;
    
    iid = ds_list_find_value(allsprites,index++);
    obj = ds_list_find_value(allsprites,index++);
    xx = ds_list_find_value(allsprites,index++);
    yy = ds_list_find_value(allsprites,index++);
    sp = ds_list_find_value(allsprites,index++);
    spindex = ds_list_find_value(allsprites,index++);
    col = ds_list_find_value(allsprites,index++);
    angle = ds_list_find_value(allsprites,index++);
    alpha = ds_list_find_value(allsprites,index++);
    xsc = ds_list_find_value(allsprites,index++);
    ysc = ds_list_find_value(allsprites,index++);
    hp = ds_list_find_value(allsprites,index++);
    max_hp = ds_list_find_value(allsprites,index++);
    spwidth = ds_list_find_value(allsprites,index++);
    spheight = ds_list_find_value(allsprites,index++);
    face_dir = ds_list_find_value(allsprites,index++);
    state = ds_list_find_value(allsprites,index++);
    
    if (sp != -1 &amp;&amp; sp != spr_ship_edit) {
      if (obj == obj_enemy_shark || obj == obj_large_shark || obj == obj_boss_shark) {
        if (state == SHARK_ATTACK || state == SHARK_DIE || state == SHARK_DEAD) {
          draw_sprite_ext(sp, spindex, xx, yy, 1, face_dir, angle, col, alpha);

        } else {
          draw_sprite_ext(sp, spindex, xx, yy, face_dir, 1, angle, col, alpha);
        }
      } else {
        draw_sprite_ext(sp, spindex, xx, yy, xsc, ysc, angle, col, alpha);
      }
    }
    
    // Draw healthbar
    if (max_hp &gt; 0 &amp;&amp; hp &gt; 0) {
      //show_debug_message("received hp = "+string(hp))
      //show_debug_message("received max hp = "+string(max_hp))
      //show_debug_message("% hp = "+string((hp*100.0)/max_hp))
      draw_healthbar(xx-(spwidth/2)-4, yy-(spheight/2)-12, xx+(spwidth/2)+4, yy-(spheight/2)-8,(hp*100.0)/max_hp, make_color_rgb(255,65,40),c_lime, c_green, 0, true, false)
    }
}




</string>
          </argument>
        </arguments>
      </action>
    </event>
  </events>
  <PhysicsObject>0</PhysicsObject>
  <PhysicsObjectSensor>0</PhysicsObjectSensor>
  <PhysicsObjectShape>0</PhysicsObjectShape>
  <PhysicsObjectDensity>0.5</PhysicsObjectDensity>
  <PhysicsObjectRestitution>0.100000001490116</PhysicsObjectRestitution>
  <PhysicsObjectGroup>0</PhysicsObjectGroup>
  <PhysicsObjectLinearDamping>0.100000001490116</PhysicsObjectLinearDamping>
  <PhysicsObjectAngularDamping>0.100000001490116</PhysicsObjectAngularDamping>
  <PhysicsObjectFriction>0.200000002980232</PhysicsObjectFriction>
  <PhysicsObjectAwake>-1</PhysicsObjectAwake>
  <PhysicsObjectKinematic>0</PhysicsObjectKinematic>
  <PhysicsShapePoints/>
</object>
